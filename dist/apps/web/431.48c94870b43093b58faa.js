"use strict";var it=Object.defineProperty,rt=(g,l,c)=>l in g?it(g,l,{enumerable:!0,configurable:!0,writable:!0,value:c}):g[l]=c,_=(g,l,c)=>(rt(g,"symbol"!=typeof l?l+"":l,c),c);(self.webpackChunkcar_mkd_systems_v2=self.webpackChunkcar_mkd_systems_v2||[]).push([[431],{1431:(g,l,c)=>{c.r(l),c.d(l,{CategoryModule:()=>C});var v=c(2057),h=c(4751),Q=c(2684),$=c(4550),Z=c(5396),w=c(4207),A=c(2332),I=c(3928),M=c(4020),S=c(9309),f=c(1107),u=c(4762),m=c(9311),J=c(2066);let d=class{constructor(){_(this,"name")}};(0,u.gn)([(0,m.C)(),(0,J.XV)({message:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435"})],d.prototype,"name",void 0),d=(0,u.gn)([(0,m.C)()],d);var k=c(1767),H=c(8902),E=c(3875);let p=class{constructor(){_(this,"name"),_(this,"order"),_(this,"category")}};(0,u.gn)([(0,m.C)(),(0,J.XV)({message:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435"})],p.prototype,"name",void 0),(0,u.gn)([(0,m.C)(),(0,E.$i)({message:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435"})],p.prototype,"order",void 0),(0,u.gn)([(0,m.C)(),(0,E.$i)({message:"\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u0430 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f"}),(0,H.D)(()=>k.n)],p.prototype,"category",void 0),p=(0,u.gn)([(0,m.C)()],p);var x=c(8280),t=c(4788),q=c(9021),F=c(2872),R=c(9441),D=c(4185),Y=c(3013),B=c(3881);function U(a,n){1&a&&t._UZ(0,"car-spinner")}function O(a,n){if(1&a){const e=t.EpF();t.TgZ(0,"div",10),t.TgZ(1,"div",11),t.TgZ(2,"p-checkbox",12),t.NdJ("ngModelChange",function(o){return t.CHM(e),t.oxw(2).folding=o})("onChange",function(){return t.CHM(e),t.oxw(2).setFolding()}),t.qZA(),t.TgZ(3,"label",13),t._uU(4,"\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0441\u0432\u043e\u0440\u0430\u0447\u0438\u0432\u0430\u043d\u0438\u0435"),t.qZA(),t.qZA(),t.qZA()}if(2&a){const e=t.oxw(2);t.xp6(2),t.Q6J("ngModel",e.folding),t.xp6(1),t.Q6J("for","folding")}}function j(a,n){if(1&a){const e=t.EpF();t.TgZ(0,"p",23),t.TgZ(1,"span",24),t.NdJ("click",function(o){t.CHM(e);const i=t.oxw(2).$implicit,s=t.oxw(3);return o.stopPropagation(),s.editableId=i._id,s.categoryEdit.name=i.name}),t._uU(2),t.qZA(),t.qZA()}if(2&a){const e=t.oxw(2).$implicit;t.xp6(2),t.hij(" ",e.name," ")}}function V(a,n){if(1&a){const e=t.EpF();t.TgZ(0,"div",25),t.NdJ("click",function(o){return o.stopPropagation()}),t.TgZ(1,"button",26),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2).$implicit,i=t.oxw(3);return i.updateCategory(o,i.categoryEdit)}),t.qZA(),t.TgZ(2,"input",27),t.NdJ("ngModelChange",function(o){return t.CHM(e),t.oxw(5).categoryEdit.name=o})("keydown.enter",function(o){t.CHM(e);const i=t.oxw(2).$implicit,s=t.oxw(3);return o.stopPropagation(),s.updateCategory(i,s.categoryEdit)}),t.qZA(),t.TgZ(3,"button",28),t.NdJ("click",function(o){t.CHM(e);const i=t.oxw(5);return o.stopPropagation(),i.editableId=null}),t.qZA(),t.qZA()}if(2&a){const e=t.oxw(5);t.xp6(1),t.Q6J("loading",e.saving),t.xp6(1),t.Q6J("ngModel",e.categoryEdit.name),t.xp6(1),t.Q6J("loading",e.saving)}}function G(a,n){if(1&a){const e=t.EpF();t.TgZ(0,"div",18),t.TgZ(1,"div",3),t.YNc(2,j,3,1,"p",19),t.YNc(3,V,4,3,"div",20),t.qZA(),t.TgZ(4,"div",21),t.TgZ(5,"button",22),t.NdJ("click",function(o){t.CHM(e);const i=t.oxw().$implicit,s=t.oxw(3);return o.stopPropagation(),s.deleteCategory(i)}),t.qZA(),t.qZA(),t.qZA()}if(2&a){const e=t.oxw().$implicit,r=t.oxw(3);t.xp6(2),t.Q6J("ngIf",r.editableId!==e._id),t.xp6(1),t.Q6J("ngIf",r.editableId===e._id),t.xp6(2),t.Q6J("loading",r.saving)}}function P(a,n){if(1&a){const e=t.EpF();t.TgZ(0,"p",43),t.TgZ(1,"span",44),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().ngIf,i=t.oxw(6);return i.editableId=o._id,i.characteristicEdit.name=o.name}),t._uU(2),t.qZA(),t.qZA()}if(2&a){const e=t.oxw().ngIf;t.xp6(2),t.hij(" ",e.name," ")}}function X(a,n){if(1&a){const e=t.EpF();t.TgZ(0,"div",45),t.TgZ(1,"button",26),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().ngIf,i=t.oxw(6);return i.updateCharacteristic(o,i.characteristicEdit)}),t.qZA(),t.TgZ(2,"input",27),t.NdJ("ngModelChange",function(o){return t.CHM(e),t.oxw(7).characteristicEdit.name=o})("keydown.enter",function(){t.CHM(e);const o=t.oxw().ngIf,i=t.oxw(6);return i.updateCharacteristic(o,i.characteristicEdit)}),t.qZA(),t.TgZ(3,"button",28),t.NdJ("click",function(){return t.CHM(e),t.oxw(7).editableId=null}),t.qZA(),t.qZA()}if(2&a){const e=t.oxw(7);t.xp6(1),t.Q6J("loading",e.saving),t.xp6(1),t.Q6J("ngModel",e.characteristicEdit.name),t.xp6(1),t.Q6J("loading",e.saving)}}function z(a,n){if(1&a){const e=t.EpF();t.TgZ(0,"tr",36),t.TgZ(1,"td",37),t._UZ(2,"span",38),t.qZA(),t.TgZ(3,"td"),t.YNc(4,P,3,1,"p",39),t.YNc(5,X,4,3,"div",40),t.qZA(),t.TgZ(6,"td",41),t.TgZ(7,"button",42),t.NdJ("click",function(){const i=t.CHM(e).ngIf,s=t.oxw(3).$implicit;return t.oxw(3).deleteCharacteristic(i,s)}),t.qZA(),t.qZA(),t.qZA()}if(2&a){const e=n.ngIf,r=t.oxw().rowIndex,o=t.oxw(5);t.Q6J("pReorderableRow",r),t.xp6(4),t.Q6J("ngIf",o.editableId!==e._id),t.xp6(1),t.Q6J("ngIf",o.editableId===e._id),t.xp6(2),t.Q6J("loading",o.saving)}}function K(a,n){if(1&a&&t.YNc(0,z,8,4,"tr",35),2&a){const e=n.$implicit,r=t.oxw(5);t.Q6J("ngIf",r.toCharacteristic(e))}}const N=function(a){return{"ng-invalid ng-dirty":a}};function L(a,n){if(1&a){const e=t.EpF();t.TgZ(0,"p-panel",29),t.TgZ(1,"div",2),t.TgZ(2,"div",3),t.TgZ(3,"span",4),t.TgZ(4,"input",30),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw().index;return t.oxw(3).characteristic[i].name=o})("focusin",function(){t.CHM(e);const o=t.oxw().index;return t.oxw(3).errorsCharacteristic[o]=null}),t.qZA(),t.TgZ(5,"label",31),t._uU(6,"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043a\u0438"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(7,"p-button",7),t.NdJ("onClick",function(){t.CHM(e);const o=t.oxw(),i=o.$implicit,s=o.index;return t.oxw(3).createCharacteristic(i,s)}),t.qZA(),t.qZA(),t.qZA(),t.TgZ(8,"div",32),t.TgZ(9,"p-table",33),t.NdJ("onRowReorder",function(o){t.CHM(e);const i=t.oxw().$implicit;return t.oxw(3).rowReorder(o,i)}),t.ALo(10,"orderBy"),t.YNc(11,K,1,1,"ng-template",34),t.qZA(),t.qZA()}if(2&a){const e=t.oxw(),r=e.index,o=e.$implicit,i=t.oxw(3);t.xp6(4),t.Q6J("ngModel",i.characteristic[r].name)("ngClass",t.VKq(8,N,null==i.errorsCharacteristic[r]?null:i.errorsCharacteristic[r].name)),t.xp6(3),t.Q6J("loading",i.saving),t.xp6(2),t.Q6J("value",t.xi3(10,5,o.characteristics,"order:number"))("reorderableColumns",!0)}}function W(a,n){1&a&&(t.TgZ(0,"p-accordionTab"),t.YNc(1,G,6,3,"ng-template",16),t.YNc(2,L,12,10,"ng-template",17),t.qZA())}function tt(a,n){if(1&a&&(t.TgZ(0,"p-accordion",14),t.YNc(1,W,3,0,"p-accordionTab",15),t.qZA()),2&a){const e=t.oxw(2);t.Q6J("multiple",!e.folding),t.xp6(1),t.Q6J("ngForOf",e.categories)}}function et(a,n){if(1&a){const e=t.EpF();t.TgZ(0,"div"),t.TgZ(1,"p-panel",1),t.TgZ(2,"div",2),t.TgZ(3,"div",3),t.TgZ(4,"span",4),t.TgZ(5,"input",5),t.NdJ("ngModelChange",function(o){return t.CHM(e),t.oxw().category.name=o})("focusin",function(){return t.CHM(e),t.oxw().errorsCategory=null}),t.qZA(),t.TgZ(6,"label",6),t._uU(7,"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438"),t.qZA(),t.qZA(),t.qZA(),t.TgZ(8,"p-button",7),t.NdJ("onClick",function(){return t.CHM(e),t.oxw().createCategory()}),t.qZA(),t.qZA(),t.qZA(),t.YNc(9,O,5,2,"div",8),t.YNc(10,tt,2,2,"p-accordion",9),t.qZA()}if(2&a){const e=t.oxw();t.xp6(5),t.Q6J("ngModel",e.category.name)("ngClass",t.VKq(5,N,null==e.errorsCategory?null:e.errorsCategory.name)),t.xp6(3),t.Q6J("loading",e.saving),t.xp6(1),t.Q6J("ngIf",null==e.categories?null:e.categories.length),t.xp6(1),t.Q6J("ngIf",e.categories)}}const T=class{constructor(n,e,r){_(this,"categoryStateService"),_(this,"confirmDialogService"),_(this,"errorService"),_(this,"categories"),_(this,"category",new d),_(this,"errorsCategory"),_(this,"characteristic"),_(this,"errorsCharacteristic"),_(this,"loading",!0),_(this,"saving",!1),_(this,"categoryEdit",new d),_(this,"characteristicEdit",new p),_(this,"editableId"),_(this,"folding",!0),this.categoryStateService=n,this.confirmDialogService=e,this.errorService=r}ngOnInit(){this.categoryStateService.find().subscribe(n=>{this.categories=n,this.characteristic=this.categories.map(()=>new p),this.errorsCharacteristic=this.categories.map(()=>null),this.loading=!1}),this.folding=!localStorage.getItem("cms.category.folding")||JSON.parse(localStorage.getItem("cms.category.folding"))}createCategory(){this.saving=!0;const{valid:n,errors:e}=(0,x.G)(this.category,d);n?(this.errorsCategory=null,this.categoryStateService.create(this.category).subscribe(r=>{this.saving=!1,this.category.name=void 0,this.errorService.addSuccessMessage(`\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f ${r.name} \u0441\u043e\u0437\u0434\u0430\u043d\u0430`),this.categories.push(r),this.characteristic.push(new p),this.errorsCharacteristic.push(null)},()=>this.saving=!1)):(console.error(e),this.errorsCategory=e,this.saving=!1,this.errorService.errorValues(this.errorsCategory))}createCharacteristic(n,e){this.saving=!0,this.characteristic[e].category=n,this.characteristic[e].order=n.characteristics.length;const{valid:r,errors:o}=(0,x.G)(this.characteristic[e],p);r?(this.errorsCharacteristic[e]=null,this.categoryStateService.createCharacteristic(this.characteristic[e]).subscribe(i=>{this.saving=!1,this.characteristic[e].name=void 0,n.characteristics.push(i),this.errorService.addSuccessMessage(`\u0425\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043a\u0430 ${i.name} \u0441\u043e\u0437\u0434\u0430\u043d\u0430`)},()=>this.saving=!1)):(console.error(o),this.errorsCharacteristic[e]=o,this.saving=!1,this.errorService.errorValues(this.errorsCharacteristic[e]))}updateCategory(n,e){this.saving=!0;const{valid:r,errors:o}=(0,x.G)(e,d);r?this.categoryStateService.update(n._id,e).subscribe(i=>{this.saving=!1,this.errorService.addSuccessMessage(`\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f ${n.name} \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0430 \u043d\u0430 ${i.name}`),n.name=e.name,this.editableId=null},()=>this.saving=!1):(console.error(o),this.saving=!1,this.errorService.errorValues(o))}updateCharacteristic(n,e){this.saving=!0,e.category=n.category,e.order=n.order;const{valid:r,errors:o}=(0,x.G)(e,p);r?this.categoryStateService.updateCharacteristic(n._id,e).subscribe(i=>{this.saving=!1,this.errorService.addSuccessMessage(`\u041c\u043e\u0434\u0435\u043b\u044c ${n.name} \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0430 \u043d\u0430 ${i.name}`),n.name=e.name,this.editableId=null},()=>this.saving=!1):(console.error(o),this.saving=!1,this.errorService.errorValues(o))}deleteCategory(n){this.confirmDialogService.confirm({message:`\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e "${n.name}"?<br /><br />\u0412\u041d\u0418\u041c\u0410\u041d\u0418\u0415! \u0422\u043e\u0432\u0430\u0440 \u0441\u043d\u0438\u043c\u0435\u0442\u0441\u044f \u0441 \u043f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u0438. \u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f \u0443 \u0432\u0441\u0435\u0445 \u0442\u043e\u0432\u0430\u0440\u043e\u0432 \u0443\u0434\u0430\u043b\u044f\u0442\u0441\u044f \u0432\u043c\u0435\u0441\u0442\u0435 \u0441 \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043a\u0430\u043c\u0438`,accept:()=>{this.saving=!0,this.categoryStateService.deleteById(n._id).subscribe(()=>{this.saving=!1,this.errorService.addSuccessMessage(`\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f ${n.name} \u0443\u0434\u0430\u043b\u0435\u043d\u0430`),this.categories=this.categories.filter(e=>n._id!==e._id)})}})}deleteCharacteristic(n,e){this.confirmDialogService.confirm({message:`\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043a\u0443 "${n.name}" \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438 "${e.name}"?`,accept:()=>{this.saving=!0,this.categoryStateService.deleteCharacteristic(n._id).subscribe(()=>{this.saving=!1,this.errorService.addSuccessMessage(`\u0425\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043a\u0430 ${n.name} \u0443\u0434\u0430\u043b\u0435\u043d\u0430`),e.characteristics=e.characteristics.filter(r=>n._id!==r._id)})}})}toCharacteristic(n){return n}rowReorder(n,e){if(n.dragIndex===n.dropIndex)return;e.characteristics.forEach((o,i)=>o.order=i);const r=e.characteristics.filter((o,i)=>n.dragIndex>n.dropIndex?i>=n.dropIndex&&i<=n.dragIndex:i>=n.dragIndex&&i<=n.dropIndex);this.categoryStateService.updateOrderCharacteristics(r).subscribe()}setFolding(){localStorage.setItem("cms.category.folding",String(this.folding))}};let y=T;_(y,"\u0275fac",function(e){return new(e||T)(t.Y36(q.F),t.Y36(F.D),t.Y36(R.T))}),_(y,"\u0275cmp",t.Xpm({type:T,selectors:[["car-category"]],decls:2,vars:2,consts:[[4,"ngIf"],["header","\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044e"],[1,"grid","align-items-center","m-0","p-0"],[1,"col"],[1,"p-float-label"],["id","float-input-firm","type","text","pInputText","",1,"w-full",3,"ngModel","ngClass","ngModelChange","focusin"],["for","float-input-firm"],["label","\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c","icon","pi pi-check","styleClass","p-button-success col-fixed",3,"loading","onClick"],["class","flex justify-content-end mt-3",4,"ngIf"],["styleClass","mt-3",3,"multiple",4,"ngIf"],[1,"flex","justify-content-end","mt-3"],[1,"p-field-checkbox"],["binary","true","inputId","folding",3,"ngModel","ngModelChange","onChange"],[1,"ml-2",3,"for"],["styleClass","mt-3",3,"multiple"],[4,"ngFor","ngForOf"],["pTemplate","header"],["pTemplate","content"],[1,"grid","align-items-center","w-full","my-0"],["class","fw-bold my-0",4,"ngIf"],["class","p-inputgroup",3,"click",4,"ngIf"],[1,"col-fixed","py-0"],["pButton","","pRipple","","type","button","label","\u0423\u0434\u0430\u043b\u0438\u0442\u044c",1,"p-button-outlined","p-button-danger","ml-2",3,"loading","click"],[1,"fw-bold","my-0"],[1,"hover:text-blue-400",3,"click"],[1,"p-inputgroup",3,"click"],["type","button","pButton","","pRipple","","icon","pi pi-check",1,"p-button-success",3,"loading","click"],["type","text","pInputText","",3,"ngModel","ngModelChange","keydown.enter"],["type","button","pButton","","pRipple","","icon","pi pi-times",1,"p-button-danger",3,"loading","click"],["header","\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0445\u0430\u0440\u0430\u043a\u0442\u0435\u0440\u0438\u0441\u0442\u0438\u043a\u0443"],["id","float-input-model","type","text","pInputText","",1,"w-full",3,"ngModel","ngClass","ngModelChange","focusin"],["for","float-input-model"],[1,"mt-4"],["styleClass","basic-table",3,"value","reorderableColumns","onRowReorder"],["pTemplate","body"],[3,"pReorderableRow",4,"ngIf"],[3,"pReorderableRow"],[1,"w-3rem"],["pReorderableRowHandle","",1,"pi","pi-bars"],["class","fw-bold ml-2",4,"ngIf"],["class","p-inputgroup",4,"ngIf"],[1,"w-6rem"],["pButton","","pRipple","","type","button","label","\u0423\u0434\u0430\u043b\u0438\u0442\u044c",1,"p-button-outlined","p-button-danger",3,"loading","click"],[1,"fw-bold","ml-2"],[1,"hover:text-blue-400","cursor-pointer",3,"click"],[1,"p-inputgroup"]],template:function(e,r){1&e&&(t.YNc(0,U,1,0,"car-spinner",0),t.YNc(1,et,11,7,"div",0)),2&e&&(t.Q6J("ngIf",r.loading),t.xp6(1),t.Q6J("ngIf",!r.loading))},directives:[v.O5,D.O,M.s,h.Fj,I.o,h.JJ,h.On,v.mk,w.zx,A.XZ,Z.UQ,v.sg,Z.US,Y.jx,w.Hq,S.H,f.iA,f.qO,f.Mv],pipes:[B.d],encapsulation:2}));const ot=[{path:"",component:y,data:{title:"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438 - CMS"}}],b=class{};let C=b;_(C,"\u0275fac",function(e){return new(e||b)}),_(C,"\u0275mod",t.oAB({type:b})),_(C,"\u0275inj",t.cJS({imports:[[v.ez,Q.Bz.forChild(ot),$.G,M.Q,I.j,h.u5,w.hJ,A.nD,Z.fx,S.T,f.U$]]}))}}]);